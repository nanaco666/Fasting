# 功能规格文档

## 核心功能详解

### 1. 断食计时器 (Timer)

#### 功能描述
应用的核心功能，提供直观的断食计时体验。

#### 用户故事
- 作为用户，我想要一键开始断食，无需复杂设置
- 作为用户，我想要实时查看断食进度和剩余时间
- 作为用户，我想要在断食结束时收到通知

#### UI 设计
```
┌─────────────────────────────┐
│                             │
│      [当前状态指示器]         │
│                             │
│    ┌───────────────────┐    │
│    │                   │    │
│    │   ⏱️ 12:34:56     │    │ ← 大号数字时钟
│    │                   │    │
│    │   ──────○──────   │    │ ← 圆形进度环
│    │                   │    │
│    │   16:8 断食模式    │    │
│    │                   │    │
│    └───────────────────┘    │
│                             │
│    [    开始断食    ]        │ ← 主操作按钮
│                             │
│    上次断食: 16h 23m        │
│    本周完成: 5/7            │
│                             │
└─────────────────────────────┘
```

#### 状态流转
```
空闲 (Idle)
    ↓ 点击"开始断食"
进行中 (Fasting)
    ↓ 点击"结束断食" 或 达到目标时间
完成 (Completed)
    ↓ 自动保存记录
空闲 (Idle)
```

#### 技术实现
- 使用 `Timer` 或 `CADisplayLink` 更新 UI
- 断食开始时间存储在 `UserDefaults` (防止应用被杀)
- 后台运行时使用 `BackgroundTasks` 框架

---

### 2. 断食方案 (Presets)

#### 预设方案
| 方案名称 | 断食时长 | 进食窗口 | 描述 |
|---------|---------|---------|------|
| 16:8 | 16小时 | 8小时 | 最流行的入门方案 |
| 18:6 | 18小时 | 6小时 | 进阶方案 |
| 20:4 | 20小时 | 4小时 | 战士饮食法 |
| OMAD | 23小时 | 1小时 | 每日一餐 |
| 自定义 | 用户设置 | 用户设置 | 完全自定义 |

#### UI 设计
```
┌─────────────────────────────┐
│  选择断食方案               │
├─────────────────────────────┤
│  ┌─────────┐ ┌─────────┐   │
│  │  16:8   │ │  18:6   │   │
│  │ 16h断食  │ │ 18h断食  │   │
│  │ ✓ 推荐  │ │         │   │
│  └─────────┘ └─────────┘   │
│  ┌─────────┐ ┌─────────┐   │
│  │  20:4   │ │  OMAD   │   │
│  │ 20h断食  │ │ 23h断食  │   │
│  │         │ │ 挑战模式 │   │
│  └─────────┘ └─────────┘   │
│                             │
│  [    自定义方案    ]       │
└─────────────────────────────┘
```

---

### 3. 历史记录 (History)

#### 功能描述
以日历视图展示所有断食记录，支持查看详情和编辑。

#### UI 设计 - 日历视图
```
┌─────────────────────────────┐
│  ◀  2026年1月  ▶           │
├─────────────────────────────┤
│  日  一  二  三  四  五  六  │
│      1   2   3   4   5   6  │
│      ●   ●   ○   ●   ●      │ ← ● 表示完成断食
│  7   8   9  10  11  12  13  │
│  ●   ●   ○   ●   ●   ●   ●  │
│ 14  15  16  17  18  19  20  │
│  ●   ●   ●   ●   ●   ●   ○  │
│ 21  22  23  24  25  26  27  │
│  ★                          │ ← ★ 今天
│ 28  29  30  31              │
└─────────────────────────────┘

本月统计
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
完成 18 次 │ 总时长 288h │ 连续 7 天
```

#### UI 设计 - 记录详情
```
┌─────────────────────────────┐
│  1月21日 断食记录           │
├─────────────────────────────┤
│                             │
│  开始时间    20:00          │
│  结束时间    12:00 (+1天)   │
│  ─────────────────────────  │
│  总时长      16小时 00分    │
│  方案        16:8           │
│  状态        ✅ 已完成      │
│                             │
│  [编辑]           [删除]    │
└─────────────────────────────┘
```

---

### 4. 统计数据 (Statistics)

#### 功能描述
使用 Swift Charts 展示断食数据的可视化统计。

#### 统计维度
- **连续天数**: 当前连续断食天数
- **最长连续**: 历史最长连续天数
- **总断食时长**: 累计断食小时数
- **平均时长**: 每次断食平均时长
- **完成率**: 本周/本月完成率

#### UI 设计
```
┌─────────────────────────────┐
│  统计                       │
├─────────────────────────────┤
│                             │
│  ┌─────────────────────┐   │
│  │  🔥 7               │   │
│  │  当前连续天数        │   │
│  │  ────────────────   │   │
│  │  最长记录: 21天     │   │
│  └─────────────────────┘   │
│                             │
│  本周断食趋势              │
│  ┌─────────────────────┐   │
│  │ ▁▂▅▇█▅▂            │   │ ← Swift Charts 条形图
│  │ 一二三四五六日      │   │
│  └─────────────────────┘   │
│                             │
│  本月概览                   │
│  ━━━━━━━━━━━━━━━━━━━━━━━━  │
│  完成次数    18 次          │
│  总时长      288 小时       │
│  平均时长    16.2 小时      │
│  完成率      85%            │
│                             │
└─────────────────────────────┘
```

---

### 5. 设置 (Settings)

#### 功能列表
- 默认断食方案
- 通知设置
  - 断食开始提醒
  - 断食结束提醒
  - 进食窗口结束提醒
- 外观设置
  - 跟随系统 / 浅色 / 深色
- Apple Health 同步
- iCloud 同步开关
- 关于应用

---

## 数据模型

### FastingRecord (断食记录)

```swift
@Model
final class FastingRecord {
    var id: UUID
    var startTime: Date
    var endTime: Date?
    var targetDuration: TimeInterval  // 目标时长（秒）
    var actualDuration: TimeInterval? // 实际时长（秒）
    var presetType: FastingPreset     // 使用的方案
    var status: FastingStatus         // 状态
    var notes: String?                // 备注
    var createdAt: Date
    var updatedAt: Date
}

enum FastingPreset: String, Codable {
    case sixteen8 = "16:8"
    case eighteen6 = "18:6"
    case twenty4 = "20:4"
    case omad = "OMAD"
    case custom = "Custom"
}

enum FastingStatus: String, Codable {
    case inProgress = "in_progress"
    case completed = "completed"
    case cancelled = "cancelled"
}
```

### UserSettings (用户设置)

```swift
@Model
final class UserSettings {
    var defaultPreset: FastingPreset
    var notificationsEnabled: Bool
    var startReminderTime: Date?
    var endReminderEnabled: Bool
    var healthKitEnabled: Bool
    var iCloudSyncEnabled: Bool
}
```

---

## 页面导航结构

```
TabView
├── 首页 (Timer)
│   └── 选择方案 Sheet
├── 历史 (History)
│   └── 记录详情
│       └── 编辑记录
└── 统计 (Statistics)
    └── 详细图表

设置 (通过 NavigationStack)
├── 通知设置
├── 外观设置
├── Health 同步
├── iCloud 同步
└── 关于
```

---

## 与 Zero 的功能对比

### 我们做的（MVP 核心）
✅ 断食计时器
✅ 预设方案
✅ 历史记录
✅ 基础统计
✅ 通知提醒

### 我们不做的（避免臃肿）
❌ 营养/蛋白质追踪
❌ 水分追踪
❌ 心情记录
❌ 教育内容/文章
❌ 社区/挑战
❌ AI 功能
❌ 付费订阅墙

### 我们的差异化优势
⭐ 100% Apple 原生设计
⭐ 零注册，即开即用
⭐ 核心功能完全免费
⭐ 极致轻量 (< 20MB)
⭐ 深度系统集成 (Widget, Watch, Siri)
